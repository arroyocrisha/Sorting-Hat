<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Sorting Hat</title>

<style>
body {
  margin: 0;
  font-family: Georgia, serif;
  background: #0b0b0b;
  color: #eee;
}
.overlay {
  min-height: 100vh;
  padding: 40px;
}
h1 { text-align: center; letter-spacing: 4px; }

.question, .result-box, .followup {
  max-width: 900px;
  margin: 40px auto;
  padding: 28px;
  background: #121212;
  border-radius: 10px;
}

.options label {
  display: block;
  margin: 12px 0;
  cursor: pointer;
}

button {
  display: block;
  margin: 40px auto;
  padding: 12px 30px;
  font-size: 16px;
  background: #5b4a87;
  border: none;
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
}

#resultPage, #followUpPage { display: none; }

#resultPage {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

#houseEmoji { font-size: 90px; text-align: center; }
#houseName { font-size: 40px; text-align: center; }

#certificate {
  display: none;
  background: #f5f1e8;
  color: #000;
  padding: 50px;
  font-family: "Times New Roman", serif;
}
</style>
</head>

<body>
<div class="overlay">

<h1>üß¢ THE SORTING HAT</h1>

<form id="quiz"></form>
<button onclick="beginSorting()">Reveal My House</button>

<div id="followUpPage" class="followup">
<h2>The Hat Hesitates‚Ä¶</h2>
<p id="conflictText"></p>
<form id="followUpForm"></form>
<button onclick="resolveConflict()">Decide</button>
</div>

<div id="resultPage">
<div class="result-box">
<div id="houseEmoji"></div>
<div id="houseName"></div>
<div id="percentages"></div>
<div id="personality"></div>
<ul id="traits"></ul>
<button onclick="printCertificate()">üìú Export Certificate</button>
<button onclick="location.reload()">Take Test Again</button>
<p style="opacity:.6">by ccarroyo</p>
</div>
</div>

<div id="certificate">
<h1 style="text-align:center">Hogwarts Sorting Certificate</h1>
<h2 id="certHouse" style="text-align:center"></h2>
<p id="certPersonality"></p>
<ul id="certTraits"></ul>
<p style="margin-top:40px;text-align:center">‚Äî The Sorting Hat</p>
</div>

</div>

<script>
/* ---------- QUESTIONS ---------- */
const questions = [
{
title:"Power & Truth",
context:"You uncover a truth that could destabilize society.",
answers:[
{house:"gryffindor",text:"Reveal it publicly.",trait:"You confront chaos head-on."},
{house:"ravenclaw",text:"Study consequences first.",trait:"You value informed decisions."},
{house:"hufflepuff",text:"Protect people from harm.",trait:"You prioritize emotional safety."},
{house:"slytherin",text:"Use it strategically.",trait:"You weaponize information."}
]
},
{
title:"Leadership",
context:"People follow you, but distrust your motives.",
answers:[
{house:"hufflepuff",text:"Earn trust slowly.",trait:"You lead with patience."},
{house:"slytherin",text:"Control outcomes regardless.",trait:"You accept being feared."},
{house:"ravenclaw",text:"Rebuild systems.",trait:"You believe structure fixes chaos."},
{house:"gryffindor",text:"Prove yourself through action.",trait:"You inspire through bravery."}
]
}
];

// clone to reach 10+
while (questions.length < 12) {
questions.push(JSON.parse(JSON.stringify(questions[questions.length % 2])));
}

function shuffle(a){
return a.map(v=>({v, r:Math.random()}))
.sort((a,b)=>a.r-b.r)
.map(x=>x.v);
}

/* ---------- RENDER QUIZ ---------- */
const quiz=document.getElementById("quiz");
questions.forEach((q,i)=>{
quiz.innerHTML+=`
<div class="question">
<strong>${i+1}. ${q.title}</strong>
<p>${q.context}</p>
${shuffle(q.answers).map(a=>`
<label>
<input type="radio" name="q${i}" value="${a.house}" data-trait="${a.trait}">
${a.text}
</label>`).join("")}
</div>`;
});

/* ---------- SORTING ---------- */
let finalScore, finalTraits, conflictPair;

function beginSorting(){
const checked=[...document.querySelectorAll("input:checked")];
if(checked.length<questions.length){
alert("The hat is not finished."); return;
}

const score={gryffindor:0,ravenclaw:0,hufflepuff:0,slytherin:0};
const traits=[];
checked.forEach(c=>{
score[c.value]++; traits.push(c.dataset.trait);
});

const sorted=Object.entries(score).sort((a,b)=>b[1]-a[1]);
finalScore=score;
finalTraits=traits;

if(sorted[0][1]===sorted[1][1]){
conflictPair=[sorted[0][0],sorted[1][0]];
showFollowUp();
} else {
showResult();
}
}

/* ---------- FOLLOW-UP ---------- */
function showFollowUp(){
document.getElementById("followUpPage").style.display="block";
document.getElementById("conflictText").innerText =
`The hat senses tension between ${conflictPair[0]} and ${conflictPair[1]}. One final question:`;

document.getElementById("followUpForm").innerHTML=`
<label><input type="radio" name="f" value="${conflictPair[0]}">
I trust my instincts.</label>
<label><input type="radio" name="f" value="${conflictPair[1]}">
I trust calculated outcomes.</label>`;
}

function resolveConflict(){
const choice=document.querySelector('input[name="f"]:checked');
if(!choice) return alert("Choose.");

finalScore[choice.value]+=1;
document.getElementById("followUpPage").style.display="none";
showResult();
}

/* ---------- RESULT ---------- */
function showResult(){
document.getElementById("resultPage").style.display="flex";

const sorted=Object.entries(finalScore).sort((a,b)=>b[1]-a[1]);
const primary=sorted[0][0];
const secondary=sorted[1][0];

const emoji={gryffindor:"ü¶Å",ravenclaw:"ü¶Ö",hufflepuff:"ü¶°",slytherin:"üêç"};

document.getElementById("houseEmoji").innerText=emoji[primary];
document.getElementById("houseName").innerHTML=
`${primary.toUpperCase()}<br><small>Secondary: ${secondary}</small>`;

document.getElementById("percentages").innerHTML=
sorted.map(h=>`${emoji[h[0]]} ${h[0]}: ${Math.round(h[1]/questions.length*100)}%`).join("<br>");

const dark = finalScore.slytherin >= Math.ceil(questions.length*0.5);

const personality =
`You are shaped primarily by ${primary}, guiding how you act under pressure.
${secondary !== primary ? `Your ${secondary} influence complicates your decisions.` : ""}
${dark ? "You are willing to cross lines for control." :
"You maintain internal limits, even when tempted."}`;

document.getElementById("personality").innerText=personality;

document.getElementById("traits").innerHTML =
finalTraits.slice(0,10).map(t=>`<li>${t}</li>`).join("");

/* certificate */
document.getElementById("certHouse").innerText =
`${emoji[primary]} ${primary.toUpperCase()}`;
document.getElementById("certPersonality").innerText=personality;
document.getElementById("certTraits").innerHTML=
finalTraits.slice(0,10).map(t=>`<li>${t}</li>`).join("");
}

/* ---------- CERTIFICATE ---------- */
function printCertificate(){
document.getElementById("certificate").style.display="block";
window.print();
document.getElementById("certificate").style.display="none";
}
</script>
</body>
</html>
