<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sorting Hat</title>
    <style>
        :root {
            --gryffindor: #740001;
            --ravenclaw: #0e1a40;
            --hufflepuff: #ecb939;
            --slytherin: #1a472a;
            --bg-dark: #0b0b0b;
            --card-bg: #161616;
        }

        body { margin:0; font-family: 'Georgia', serif; background: var(--bg-dark); color:#eee; line-height: 1.6; }
        .overlay { min-height:100vh; padding:20px; box-sizing: border-box; }
        h1 { text-align:center; letter-spacing:6px; margin-top: 40px; color: #d4af37; text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }

        .question, .result-box, .followup {
            max-width:700px; margin:20px auto; padding:30px; background: var(--card-bg); 
            border-radius:12px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .options label { 
            display:block; text-align:left; margin:15px 0; padding: 12px;
            background: #1f1f1f; border-radius: 8px; cursor:pointer; transition: 0.3s;
        }
        .options label:hover { background: #2a2a2a; border-left: 4px solid #d4af37; }
        
        input[type="radio"] { margin-right: 15px; transform: scale(1.2); }

        button { 
            display:block; margin:30px auto; padding:15px 40px; font-size:16px; 
            background:#5b4a87; border:none; color:#fff; border-radius:8px; 
            cursor:pointer; font-weight: bold; transition: 0.3s;
        }
        button:hover { background: #7a66b1; transform: translateY(-2px); }

        #resultPage, #followUpPage { display:none; }
        
        /* Result styling */
        .result-box { text-align: center; }
        #houseEmoji { font-size:100px; margin-bottom: 10px; }
        #houseName { font-size:42px; font-weight: bold; color: #d4af37; margin-bottom: 20px; }
        #percentages { font-family: monospace; font-size: 1.1rem; margin-bottom: 20px; color: #bbb; }
        #traits { text-align: left; columns: 2; margin-top: 20px; }
        #traits li { margin-bottom: 8px; color: #ddd; }

        /* Certificate Print Settings */
        #certificate { display:none; }
        @media print {
            body { background: white; color: black; }
            .overlay, #resultPage, button { display: none !important; }
            #certificate { 
                display:block !important; 
                background:#f5f1e8; color:#000; padding:80px; 
                font-family:"Times New Roman", serif; border: 15px double #333;
                text-align: center; height: 100vh; box-sizing: border-box;
            }
            #certTraits { text-align: left; display: inline-block; }
        }
    </style>
</head>
<body>

<div class="overlay" id="main-content">
    <h1>üß¢ THE SORTING HAT</h1>
    <form id="quiz"></form>
    <button type="button" id="revealBtn" onclick="beginSorting()">Reveal My House</button>
</div>

<div id="followUpPage" class="followup">
    <h2>The Hat Hesitates‚Ä¶</h2>
    <p id="conflictText"></p>
    <div id="followUpForm" class="options"></div>
    <button onclick="resolveConflict()">Make My Decision</button>
</div>

<div id="resultPage">
    <div class="result-box">
        <div id="houseEmoji"></div>
        <div id="houseName"></div>
        <div id="percentages"></div>
        <div id="personality" style="font-style: italic; margin-bottom: 20px;"></div>
        <h3 style="border-bottom: 1px solid #444; padding-bottom: 10px;">Your Dominant Traits</h3>
        <ul id="traits"></ul>
        
        <div style="margin-top: 40px;">
            <button onclick="printCertificate()">üìú Export Certificate</button>
            <button onclick="location.reload()" style="background: transparent; color: #888; border: 1px solid #444;">Retake Test</button>
        </div>
        <p style="opacity:.4; font-size: 0.8rem; margin-top: 20px;">Crafted by ccarroyo</p>
    </div>
</div>

<div id="certificate">
    <p style="font-size: 1.2rem; margin-bottom: 0;">OFFICIAL DECREE</p>
    <h1 style="font-size: 3rem; margin-top: 10px;">Hogwarts Sorting Certificate</h1>
    <hr>
    <p>Be it known that the wearer of the Hat has been tested and found worthy of:</p>
    <h2 id="certHouse" style="font-size: 4rem; color: #000; margin: 20px 0;"></h2>
    <p id="certPersonality" style="font-size: 1.2rem; padding: 0 50px;"></p>
    <div style="text-align: left; max-width: 400px; margin: 0 auto;">
        <h3>Verified Virtues:</h3>
        <ul id="certTraits"></ul>
    </div>
    <p style="margin-top:80px; font-weight: bold; font-size: 1.5rem;">‚Äî Godric Gryffindor, Helga Hufflepuff, Rowena Ravenclaw, & Salazar Slytherin ‚Äî</p>
</div>

<script>
const questions = [
    { title:"The Forbidden Tome", context:"You find a magical book that can amplify any power but may corrupt.", answers:[
        {house:"gryffindor",text:"Destroy it; power must be earned, not stolen.",trait:"Moral Courage"},
        {house:"ravenclaw",text:"Study it meticulously to understand its secrets.",trait:"Intellectual Curiosity"},
        {house:"hufflepuff",text:"Hide it to keep others safe.",trait:"Protective Loyalty"},
        {house:"slytherin",text:"Use it to gain advantage.",trait:"Strategic Ambition"}
    ]},
    { title:"The Vanishing Village", context:"A village is trapped in an enchantment causing endless misery.", answers:[
        {house:"hufflepuff",text:"Help them quietly, everyone deserves kindness.",trait:"Quiet Compassion"},
        {house:"slytherin",text:"Negotiate leverage with the enchanter.",trait:"Pragmatic Cunning"},
        {house:"ravenclaw",text:"Research the enchantment before acting.",trait:"Logical Analysis"},
        {house:"gryffindor",text:"Rush in to break the curse immediately.",trait:"Bold Heroism"}
    ]},
    { title:"The Moral Dilemma", context:"A friend committed a crime to save someone‚Äôs life.", answers:[
        {house:"gryffindor",text:"Confront them and insist on facing justice.",trait:"Unyielding Honesty"},
        {house:"ravenclaw",text:"Analyze the situation for the greater good.",trait:"Rational Detachment"},
        {house:"hufflepuff",text:"Protect them; loyalty matters most.",trait:"Unconditional Loyalty"},
        {house:"slytherin",text:"Keep the secret to gain influence.",trait:"Resourcefulness"}
    ]},
    { title:"The Shadow Duel", context:"You can defeat a dangerous opponent by risking innocent bystanders.", answers:[
        {house:"gryffindor",text:"Fight openly and risk yourself, not innocents.",trait:"Noble Sacrifice"},
        {house:"ravenclaw",text:"Calculate probability and minimize harm.",trait:"Strategic Calculation"},
        {house:"hufflepuff",text:"Avoid the fight; protect everyone.",trait:"Altruism"},
        {house:"slytherin",text:"Exploit the situation to achieve victory.",trait:"Result-Oriented"}
    ]},
    { title:"The Whispering Forest", context:"A forest whispers secrets that could destroy or save kingdoms.", answers:[
        {house:"slytherin",text:"Use the whispers to gain power.",trait:"Political Intuition"},
        {house:"hufflepuff",text:"Ignore them to protect the vulnerable.",trait:"Steadfast Ethics"},
        {house:"ravenclaw",text:"Decode and understand them fully.",trait:"Scholarly Pursuit"},
        {house:"gryffindor",text:"Venture boldly to confront whatever lies ahead.",trait:"Fearless Exploration"}
    ]}
    // ... Additional questions follow the same structure
];

function shuffle(a){return a.map(v=>({v, r:Math.random()})).sort((a,b)=>a.r-b.r).map(x=>x.v);}

const quizContainer = document.getElementById("quiz");
questions.forEach((q, i) => {
    const qDiv = document.createElement("div");
    qDiv.className = "question";
    qDiv.innerHTML = `<strong>${i + 1}. ${q.title}</strong><p>${q.context}</p><div class="options">
        ${shuffle(q.answers).map(a => `
            <label>
                <input type="radio" name="q${i}" value="${a.house}" data-trait="${a.trait}">
                ${a.text}
            </label>`).join("")}
    </div>`;
    quizContainer.appendChild(qDiv);
});

let finalScore, finalTraits, conflictPair;

function beginSorting() {
    const checked = [...document.querySelectorAll("input:checked")];
    if (checked.length < questions.length) {
        alert("The Sorting Hat requires all answers before it can speak.");
        return;
    }

    const score = { gryffindor: 0, ravenclaw: 0, hufflepuff: 0, slytherin: 0 };
    const allUserTraits = [];
    
    checked.forEach(c => {
        score[c.value]++;
        allUserTraits.push({house: c.value, trait: c.dataset.trait});
    });

    finalScore = score;
    finalTraits = allUserTraits;

    const sorted = Object.entries(score).sort((a, b) => b[1] - a[1]);

    if (sorted[0][1] === sorted[1][1]) {
        conflictPair = [sorted[0][0], sorted[1][0]];
        document.getElementById("main-content").style.display = "none";
        showFollowUp();
    } else {
        showResult();
    }
}

function showFollowUp() {
    document.getElementById("followUpPage").style.display = "block";
    document.getElementById("conflictText").innerText = `The hat senses a dual nature within you: ${conflictPair[0]} and ${conflictPair[1]}. Choose the path that calls to you:`;
    document.getElementById("followUpForm").innerHTML = `
        <label><input type="radio" name="f" value="${conflictPair[0]}"> I follow my heart and my instincts.</label>
        <label><input type="radio" name="f" value="${conflictPair[1]}"> I follow logic and the calculated path.</label>`;
}

function resolveConflict() {
    const choice = document.querySelector('input[name="f"]:checked');
    if (!choice) return alert("You must choose.");
    finalScore[choice.value] += 0.1; // Slight nudge to break tie
    document.getElementById("followUpPage").style.display = "none";
    showResult();
}

function showResult() {
    document.getElementById("main-content").style.display = "none";
    document.getElementById("resultPage").style.display = "block";
    
    const sorted = Object.entries(finalScore).sort((a, b) => b[1] - a[1]);
    const primary = sorted[0][0];
    const secondary = sorted[1][0];
    const emoji = { gryffindor: "ü¶Å", ravenclaw: "ü¶Ö", hufflepuff: "ü¶°", slytherin: "üêç" };

    document.getElementById("houseEmoji").innerText = emoji[primary];
    document.getElementById("houseName").innerHTML = `${primary.toUpperCase()}<br><small style="font-size:15px; color:#888;">Secondary Influence: ${secondary}</small>`;
    
    // Percentages
    const total = Object.values(finalScore).reduce((a, b) => a + b, 0);
    document.getElementById("percentages").innerHTML = sorted.map(h => 
        `${emoji[h[0]]} ${h[0].toUpperCase()}: ${Math.round((h[1] / total) * 100)}%`
    ).join(" | ");

    // Trait Filtering (Only show traits matching primary house)
    const winningTraits = finalTraits.filter(t => t.house === primary).map(t => t.trait);
    const traitListHTML = winningTraits.map(t => `<li>${t}</li>`).join("");
    document.getElementById("traits").innerHTML = traitListHTML;

    const personality = `You are a true ${primary}, defined by ${winningTraits.slice(0,2).join(" and ")}. While you share traits with ${secondary}, your core values align with the legacy of ${primary}.`;
    document.getElementById("personality").innerText = personality;

    // Certificate Setup
    document.getElementById("certHouse").innerText = `${emoji[primary]} ${primary.toUpperCase()}`;
    document.getElementById("certTraits").innerHTML = traitListHTML;
    document.getElementById("certPersonality").innerText = personality;
}

function printCertificate() {
    window.print();
}
</script>

</body>
</html>
